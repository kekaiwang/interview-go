# 5.0 常用关键字

## 5.1 for 和 range

### 5.1.1 现象

#### 循环永动机

#### 神奇的指针

#### 遍历清空数组

#### 随机遍历

### 5.1.2 经典循环


### 5.1.3 范围循环

与简单的经典循环相比，范围循环在 Go 语言中更常见、实现也更复杂。这种循环同时使用 for 和 range 两个关键字，**编译器会在编译期间将所有 for-range 循环变成经典循环**。

#### 数组和切片

对于数组和切片来说，Go 语言有三种不同的遍历方式，这三种不同的遍历方式分别对应着代码中的不同条件，它们会在 `cmd/compile/internal/gc.walkrange` 函数中转换成不同的控制逻辑，我们会分成几种情况分析该函数的逻辑：

1. 分析遍历数组和切片清空元素的情况；
2. 分析使用 for range a {} 遍历数组和切片，不关心索引和数据的情况；
3. 分析使用 for i := range a {} 遍历数组和切片，只关心索引的情况；
4. 分析使用 for i, elem := range a {} 遍历数组和切片，关心索引和数据的情况

对于所有的 range 循环，Go 语言都会在编译期将原切片或者数组赋值给一个新变量 ha，在赋值的过程中就发生了拷贝，而我们又通过 len 关键字预先获取了切片的长度，所以在循环中追加新的元素也不会改变循环执行的次数，这也就解释了循环永动机一节提到的现象。

**而遇到这种同时遍历索引和元素的 range 循环时，Go 语言会额外创建一个新的 v2 变量存储切片中的元素，循环中使用的这个变量 v2 会在每一次迭代被重新赋值而覆盖，赋值时也会触发拷贝**。

#### 哈希表